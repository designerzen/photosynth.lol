<!-- <script locals>
    const image = {
        src: 'https://picsum.photos/200/300',
        alt: 'A random image from Picsum',
        width: 1080,
        height: 920
    }

    const images = [
        image,
        image,
        image,
        image,
        image
    ]

    module.exports = {
        images,
        image,
        title: locals.title || 'Gallery'
    }
</script> -->

<script locals>
    let randomUUID = "id"+Math.random().toString(36).substring(2, 15) + ""
    module.exports = {
       ...locals,
        id: locals.id || randomUUID,
        title: locals.title || 'Gallery',
    }
</script>


<section class="gallery" id="{{id}}">
    
    <ul class="gallery-grid" role="list" aria-label="{{title}}">
        <each loop="image, index in images">
            <li class="gallery-grid-item gallery-grid-item-{{index}} {{ image.height * image.width > 993600 ? 'big' : image.height * image.width > 750000 ? 'medium' : 'small' }} {{image.width>image.height*1.3 ? 'landscape' : image.height > image.width*1.3 ? 'portrait' : 'squared'}}  {{image.classes || ''}}" style="--width:{{image.width}}; --height:{{image.height}};">
        
                <figure 
                    class="gallery-figure figure-{{index}}" 
                    role="figure">
                
                    <picture 
                        class="gallery-image image-{{index}}"
                        style="--object-position-x:{{image.positionX??'50%'}};--object-position-y:{{image.positionY??'50%'}};">
                        <source srcset="{{image.src}}?as=avif&width={{image.width}}" type="image/avif" />
                        <source srcset="{{image.src}}?as=webp&width={{image.width}}" type="image/webp" />
                        <source srcset="{{image.src}}?width={{image.width}}" type="image/jpeg" />
                        <img 
                            id="gallery{{id}}image{{index}}"
                            loading="{{image.loading || 'lazy'}}"
                            src="{{image.src}}?width={{image.width}}" 
                            width="{{image.width}}" 
                            height="{{image.height}}" 
                            data-attribution="{{image.attribution ? image.attribution : ''}}"
                            alt="{{image.alt}}" />
                    </picture>

                    <figcaption class="gallery-image-caption caption-{{index}}">
                        {{image.alt}}
                    </figcaption>

                    <input 
                        id="{{id}}-button-{{index}}"    
                        class="gallery-image-toggle"
                        name="toggle-{{id}}"
                        type="radio" 
                        onclick="lightbox{{id}}image.src=gallery{{id}}image{{index}}.src;{{id}}dialog.showModal()" 
                        value="gallery{{id}}image{{index}}" />
                        
                </figure>
            </li>
        </each>
    </ul>
    
    <dialog id="{{id}}dialog" class="lightbox" closedby="any">
        <form method="dialog">
            <!-- Show the selected image above -->
            <figure class="gallery-figure" role="figure">
            
                <img 
                    id="lightbox{{id}}image" 
                    class="gallery-image"
                   />
            
                <figcaption class="gallery-image-caption">
                    <strong></strong>
                    <cite>Photograph by respective copyright holders</cite> 
                </figcaption>

            </figure>

            <menu hidden>
                <button hidden class="gallery-image-button-previous" type="button">Previous Image</button>
                <button hidden class="gallery-image-button-next" type="button">Next Image</button>

                <button type="submit" class="gallery-image-button-close" onclick="toggleFullScreen(document.querySelector('#{{id}}dialog > form'), true)">Close</button>
                <button type="button" class="gallery-image-button-fullscreen" onclick="toggleFullScreen(document.querySelector('#{{id}}dialog > form'))">Fullscreen</button>
            </menu>
           
        </form>
        <script>
            function toggleFullScreen(e, forceExit=false) {
                if (!forceExit && !document.fullscreenElement) {
                    try{
                        e.requestFullscreen()
                        document.documentElement.classList.toggle("fs", true)
                    } catch (err) {
                        
                    }
                } else {
                    try{
                        document.exitFullscreen?.()
                        document.documentElement.classList.toggle("fs", false)
                    } catch (err) {
                        
                    }
                }
            }
        </script>

    </dialog>

</section>